# 正規化 Normalization

# 目錄

---

## 正規化 (Normaliztion Form)

正規化能將原始的二維資料表達到下面兩個目的

- 降低資料重複性 (Data Redundancy)
- 避免資料更新異常 (Anomalies)

### 第一正規化 (1NF / First Normal Form)

定義與規則

- 表格內每個欄位紀錄的值為**基元值 (Atomic Value)**
- 沒有兩筆以上資料是完全重複
- 資料表中有主鍵，而其他欄位相依於主鍵

目的

- 保持**欄位內資料單一**
- **消除意義重複**性欄位
- **決定主鍵 (Primary Key)**，使其他欄位相依主鍵

作法

- 先將原始資料表轉為**二維資料表**

以下是**原始資料表**內容

| 學號：001 |  |  | 姓名：王曉明 |  |  | 性別：男 M |
| --- | --- | --- | --- | --- | --- | --- |
| 課程代碼 | 課程名稱 | 學分數 | 必選修 | 成績 | 老師編號 | 老師姓名 |
| C001 | 程式語言 | 4 | 必 | 74 | T001 | 陳一 |
| C002 | 網頁設計 | 3 | 選 | 93 | T002 | 林二 |

| 學號：002 |  |  | 姓名：林麗美 |  |  | 性別：女 F |
| --- | --- | --- | --- | --- | --- | --- |
| 課程代碼 | 課程名稱 | 學分數 | 必選修 | 成績 | 老師編號 | 老師姓名 |
| C002 | 網頁設計 | 3 | 選 | 62 | T002 | 林二 |
| C003 | 計算機概論 | 2 | 必 | 82 | T003 | 張三 |
| C005 | 網路教學 | 4 | 選 | 94 | T005 | 王五 |

原始資料以個人為記錄，要導入SQL紀錄時，需要將原始資料轉為**二維資料**，如下：

| 學號 | 姓名 | 性別 | Gender | 課程代碼 | 課程名稱 | 學分數 | 必選修 | 成績 | 教師編號 | 教師姓名 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 001 | 王曉明 | 男 | M | C001
C002 | 程式語言
網頁設計 | 4
3 | 必
選 | 74
93 | T001
T002 | 陳一
林二 |
| 002 | 林麗美 | 女 | F | C002
C003
C005 | 網頁設計
計算機概論
網路教學 | 3
2
4 | 選
必
選 | 62
82
94 | T002
T003
T005 | 林二
張三
王五 |

觀察二維資料表，
欄位 **課程代碼、課程名稱、學分數、選必修、成績、教師編號、教師姓名**，
****都發生了單一欄位多項資料的問題。
欄位 **性別、Gender**，則是發生欄位的意義重複。

- 先**消除意義重複的欄位**，只保留其中一欄，得到

| 學號 | 姓名 | 性別 | 課程代碼 | 課程名稱 | 學分數 | 必選修 | 成績 | 教師編號 | 教師姓名 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 001 | 王曉明 | 男 | C001
C002 | 程式語言
網頁設計 | 4
3 | 必
選 | 74
93 | T001
T002 | 陳一
林二 |
| 002 | 林麗美 | 女 | C002
C003
C005 | 網頁設計
計算機概論
網路教學 | 3
2
4 | 選
必
選 | 62
82
94 | T002
T003
T005 | 林二
張三
王五 |
- 單一欄位多項資料的問題則**將每項資料拆至不同的紀錄中**，得到

| 學號 | 姓名 | 性別 | 課程代碼 | 課程名稱 | 學分數 | 必選修 | 成績 | 教師編號 | 教師姓名 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 001 | 王曉明 | 男 | C001 | 程式語言 | 4 | 必 | 74 | T001 | 陳一 |
| 001 | 王曉明 | 男 | C002 | 網頁設計 | 3 | 選 | 93 | T002 | 林二 |
| 002 | 林麗美 | 女 | C002 | 網頁設計 | 3 | 選 | 62 | T002 | 林二 |
| 002 | 林麗美 | 女 | C003 | 計算機概論 | 2 | 必 | 82 | T003 | 張三 |
| 002 | 林麗美 | 女 | C005 | 網路教學 | 4 | 選 | 94 | T005 | 王五 |
- 設定**主鍵**，主鍵是儲存資料物件予以**唯一和完整標識**的資料列或屬性的鍵，
在上表中，**學號**為識別學生身分的唯一標示，**課程代碼**為識別課程名稱與教師的標示，
學號與課程代碼組合能查詢成績，所以可以選擇**學號與課程代碼為複合主鍵**，得到

| **學號** | 姓名 | 性別 | **課程代碼** | 課程名稱 | 學分數 | 必選修 | 成績 | 教師編號 | 教師姓名 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 001 | 王曉明 | 男 | C001 | 程式語言 | 4 | 必 | 74 | T001 | 陳一 |
| 001 | 王曉明 | 男 | C002 | 網頁設計 | 3 | 選 | 93 | T002 | 林二 |
| 002 | 林麗美 | 女 | C002 | 網頁設計 | 3 | 選 | 62 | T002 | 林二 |
| 002 | 林麗美 | 女 | C003 | 計算機概論 | 2 | 必 | 82 | T003 | 張三 |
| 002 | 林麗美 | 女 | C005 | 網路教學 | 4 | 選 | 94 | T005 | 王五 |

對上表進行檢查，會發現以下三種異常

- **新增異常檢查 (Insert Anomaly)**
發現若要單純新增課程資料，會發生**主鍵或複合主鍵為空值**的問題

| **學號** | 姓名 | 性別 | **課程代碼** | 課程名稱 | 學分數 | 必選修 | 成績 | 教師編號 | 教師姓名 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| NULL |  |  | C006 | 網路教學 |  |  |  |  |  |
- **修改異常檢查 (Update Anomaly)**
針對網頁設計的學生進行統一加分，由於資料重複多次，可能造成部分紀錄未修改到，
導致**資料不一致**。
- **刪除異常檢查 (Delete Anomaly)**
若刪除第四列紀錄，則會發生課程 計算機概論 的**相關資訊同時被刪除。**

至此進入**第二正規化 (2NF)**

---

### 第二正規化 (2NF / Second Normal Form)

定義與規則

- 符合**第一正規化 (1NF)**
- 每項非鍵屬性必須「**完全相依**」於主鍵，**不可**「**部分功能相依**」於主鍵

> 參閱 [功能相依性](功能相依性%20Functional%20Dependency.md) 筆記
> 

目的

- **去除部分功能相依性**

作法

- 將部分功能相依性的**欄位分割成新的資料表**

沿用1NF後的資料表

| **學號** | 姓名 | 性別 | **課程代碼** | 課程名稱 | 學分數 | 必選修 | 成績 | 教師編號 | 教師姓名 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 001 | 王曉明 | 男 | C001 | 程式語言 | 4 | 必 | 74 | T001 | 陳一 |
| 001 | 王曉明 | 男 | C002 | 網頁設計 | 3 | 選 | 93 | T002 | 林二 |
| 002 | 林麗美 | 女 | C002 | 網頁設計 | 3 | 選 | 62 | T002 | 林二 |
| 002 | 林麗美 | 女 | C003 | 計算機概論 | 2 | 必 | 82 | T003 | 張三 |
| 002 | 林麗美 | 女 | C005 | 網路教學 | 4 | 選 | 94 | T005 | 王五 |
- 檢查是否存在「部分功能相依」
資料表的主鍵是由學號與課程代碼組成的**複合主鍵**，
但$\{$姓名，性別$\}$，只有相依於學號；
$\{$課程名稱，學分數，必選修，老師編號，老師姓名$\}$，只相依於課程代碼；

因為學號或課程代碼為複合主鍵$\{$姓名，學號$\}$的一部分，
而上述相依性除了「成績」之外，其餘皆只相依於主鍵的一部分

$\therefore$ **存在部分功能相依性**。
- 將「部分功能相依」的**欄位分割**出去，並另外**組成新的資料表**，
可得到三個小的資料表，如下：

學生資料表 ( **學號**，姓名，性別)

| **學號** | 姓名 | 性別 |
| --- | --- | --- |
| 001 | 王曉明 | 男 |
| 002 | 林麗美 | 女 |

成績資料表 (**學號**，**課程代碼**，成績)

| **學號** | **課程代碼** | 成績 |
| --- | --- | --- |
| 001 | C001 | 74 |
| 001 | C002 | 93 |
| 002 | C002 | 62 |
| 002 | C003 | 82 |
| 002 | C005 | 94 |

課程資料表 ( **課程代碼**，課程名稱，學分數，必選修，老師編號，老師姓名)

| **課程代碼** | 課程名稱 | 學分數 | 必選修 | 教師編號 | 教師姓名 |
| --- | --- | --- | --- | --- | --- |
| C001 | 程式語言 | 4 | 必 | T001 | 陳一 |
| C002 | 網頁設計 | 3 | 選 | T002 | 林二 |
| C003 | 計算機概論 | 2 | 必 | T003 | 張三 |
| C005 | 網路教學 | 4 | 選 | T005 | 王五 |
- 因為$\{$成績$\}$，**完全相依**於 $\{$姓名，學號$\}$，所以無需再分割。

- 檢查是否仍有部分相依性存在，
上列三個資料表皆無部份相依性存在。

除「課程資料表」之外，其餘兩個資料表已符合2NF，**3NF**，**BCNF。**

- 若是針對課程資料表檢查，會發現教師姓名相依於教師編號，
而教師編號相依於課程代碼，如此相依性關係，稱為遞移相依。

遞移相依會發生

- **新增異常**，例如：
同一門課程有多位教師，而**要新增教師，必須先新增課程代碼**，
但是課程代碼為主鍵，是唯一且不重複的，無法新增相同的課程代碼，
導致教師編號無法新增，教師姓名也無法新增。
- **更新異常**，例如：
要更新該授課教師的課程時，需要先將該教師的紀錄找出，可能造成**資料不一致**。
- **刪除異常**，例如：
若該教師只有一門課程，而當刪除該課程時，該教師的**資料會相應的移除**，導致教師資料出問題。

因此需要透過**第三正規化**處理。

---

### 第三正規化 (3NF / Third Normal Form)

定義與規則

- 符合**第二正規化 (2NF)**
- 各欄位與主鍵之間**沒有**「**遞移相依**」的關係
即：非鍵值屬性間，不存在功能相依性

> 參閱 [功能相依性](功能相依性%20Functional%20Dependency.md) 筆記
> 

目的

- **去除遞移相依性**

作法

- 尋找**與主鍵無關的相依性**
最簡單的方法就是**從左到右掃瞄**資料表中各欄位，
檢查有無「**與主鍵無關的相依性**」存在。

若存在則表示有「遞移相依」存在，反之則無。

沿用 2NF 後的資料表

學生資料表 ( **學號**，姓名，性別)

| **學號** | 姓名 | 性別 |
| --- | --- | --- |
| 001 | 王曉明 | 男 |
| 002 | 林麗美 | 女 |

成績資料表 (**學號**，**課程代碼**，成績)

| **學號** | **課程代碼** | 成績 |
| --- | --- | --- |
| 001 | C001 | 74 |
| 001 | C002 | 93 |
| 002 | C002 | 62 |
| 002 | C003 | 82 |
| 002 | C005 | 94 |

課程資料表 ( **課程代碼**，課程名稱，學分數，必選修，老師編號，老師姓名)

| **課程代碼** | 課程名稱 | 學分數 | 必選修 | 教師編號 | 教師姓名 |
| --- | --- | --- | --- | --- | --- |
| C001 | 程式語言 | 4 | 必 | T001 | 陳一 |
| C002 | 網頁設計 | 3 | 選 | T002 | 林二 |
| C003 | 計算機概論 | 2 | 必 | T003 | 張三 |
| C005 | 網路教學 | 4 | 選 | T005 | 王五 |

檢查後發現
$\because$ 教師編號相依於**課程代碼**，而教師姓名相依於教師編號，
存在與主鍵無關的相依性，表示教師姓名與主鍵 (課程代碼) 無關，

$\therefore$ 存在遞移相依

欄位 ( 課程名稱，學分數，必選修，教師編號 )，皆為直接相依於 ( 課程代碼 )。
而欄位 ( 教師姓名 )，直接相依於 ( 教師編號 ) ，才間接相依於 ( 課程代碼 )，
並不是直接相依，稱為「**遞移相依**」。

- 將遞移相依的欄位分割出去，再另外組成「新的資料表」 。 
因此，我們將「課程資料表」分割為二個資料表，
並且利用**外鍵(F.K.)** 來連接二個資料表。

課程資料表
(**課程代碼**，課程名稱，學分數，必選修，**教師編號#**)

教師資料表
(**教師編號**，教師姓名)

| **課程代碼** | 課程名稱 | 學分數 | 必選修 | **教師編號#** |
| --- | --- | --- | --- | --- |
| C001 | 程式語言 | 4 | 必 | T001 |
| C002 | 網頁設計 | 3 | 選 | T002 |
| C003 | 計算機
概論 | 2 | 必 | T003 |
| C005 | 網路教學 | 4 | 選 | T005 |

| **教師編號** | 教師姓名 |
| --- | --- |
| T001 | 陳一 |
| T002 | 林二 |
| T003 | 張三 |
| T005 | 王五 |

經過第三正規化後，共產生四個表格

學生資料表 ( **學號**，姓名，性別)

成績資料表 (**學號**，**課程代碼**，成績)

| **學號** | 姓名 | 性別 |
| --- | --- | --- |
| 001 | 王曉明 | 男 |
| 002 | 林麗美 | 女 |

| **學號** | **課程代碼** | 成績 |
| --- | --- | --- |
| 001 | C001 | 74 |
| 001 | C002 | 93 |
| 002 | C002 | 62 |
| 002 | C003 | 82 |
| 002 | C005 | 94 |

課程資料表
(**課程代碼**，課程名稱，學分數，必選修，**教師編號#**)

教師資料表
(**教師編號**，教師姓名)

| **課程代碼** | 課程名稱 | 學分數 | 必選修 | **教師編號#** |
| --- | --- | --- | --- | --- |
| C001 | 程式語言 | 4 | 必 | T001 |
| C002 | 網頁設計 | 3 | 選 | T002 |
| C003 | 計算機
概論 | 2 | 必 | T003 |
| C005 | 網路教學 | 4 | 選 | T005 |

| **教師編號** | 教師姓名 |
| --- | --- |
| T001 | 陳一 |
| T002 | 林二 |
| T003 | 張三 |
| T005 | 王五 |

其中，學生資料表、成績資料表為 2NF 後產生，
課程資料表、教師資料表為 3NF 後產生。

至此即完成第三正規化 3NF，接著介紹 **BCNF。**

---

### BCNF (Boyce-Codd Normal Form)

適用時機

- 若資料表**「主鍵」為「多個欄位」組成**，則必須再執行 BCNF。

定義與規則

- 若「主鍵」為「單一欄位」組成，則符合 3NF 也符合 BCNF 。
- 符合**第三正規化 (3NF)**
- 「**主鍵**」中各欄位**不能相依於**其他**非主鍵的欄位**。
- 一個關聯 R 為 BCNF 表格，若且唯若該關聯表中的**功能相依性之決定因素都是候選鍵**。

目的

- 更嚴格的**去除遞移相依性**

作法

- 檢視資料表中的主鍵是否有相依於其他非鍵值屬性。

以 3NF 後的資料表中，成績資料表為範例：

成績資料表 (**學號**，**課程代碼**，成績)

| **學號** | **課程代碼** | 成績 |
| --- | --- | --- |
| 001 | C001 | 74 |
| 001 | C002 | 93 |
| 002 | C002 | 62 |
| 002 | C003 | 82 |
| 002 | C005 | 94 |

成績資料表的主鍵由 $\{$ **學號**，**課程代碼 $\}$** 組成，為複合主鍵，
可以檢視是否符合 BCNF 。

成績是屬於個人的，所以成績相依於學號；
並且每堂課程的成績不同，所以成績也相依於課程代碼。

由上述所了解，資料表中學號與課程代碼皆為**決定因素**，
並且學號**不相依**成績；課程代碼**不相依**於成績。

$\because$ 學號，課程代碼，個別並無相依於成績，表示鍵值屬性未相依於非鍵值屬性，
　 且功能相依性的決定因素皆為候選鍵。

$\therefore$ 成績資料表符合 BCNF

---

## 結論

在資料庫設計中，正規化是一個重要的概念，它可以幫助我們設計出更好的資料庫架構，同時也能提高資料庫的效能和可靠性。

- 實務上正規化常使用的四個階段：
第一正規化、第二正規化、第三正規化、BCNF。
- 第一正規化 ( 1NF )
每個**欄位只包含單一的值**，而不是多個值的集合。
值應該分開成不同的欄位，且每個欄位只包含單一的值。
- 第二正規化 ( 2NF ) 
消除**非主鍵欄位與主鍵之間的部分功能相依性**。
將部分相依性的欄位分離，建立新的資料表，並透過外鍵來連接這些資料表。
- 第三正規化(3NF)
消除**非主鍵欄位遞移相依於主鍵**。
將遞移相依性的欄位分離，建立新的資料表，並透過外鍵來連接這些資料表。
- BCNF(Boyce-Codd Normal Form)。
每個決定因素皆為候選鍵。

透過正規化，可以讓資料表結構更加簡潔和明確，同時也能提高資料庫的效能和可靠性。

---

## 補充資料

> 其他正規化的補充內容，請參閱 [正規化補充](正規化補充%20Additional%20of%20normalization.md)
正規化內容包含 ( 第四、五正規化，與其他問題深入討論 )
> 

---

## 參考資料

[中華科技大學 - 陳建成 資料庫正規化](http://cc.cust.edu.tw/~ccchen/doc/db_04.pdf)

[國立聯合大學 資訊管理學系 - 陳士傑 資料庫系統課程簡報](http://debussy.im.nuu.edu.tw/sjchen/Database/Final/Ch05.pdf) 

tags: `SQL 基本常用` `基本功`